
# API在线文档
http://www.l1nkkk.xyz:8888/
# 总体架构

<center>
<img src="pic/2.png" width="100%" height="100%" />
</center>

# master服务
## 功能
- 配置信息的读取,配置文件为json文件
- 服务发现，任务管理，日志管理
  - 节点发现：可以通过监听etcd数据库来发现Worker节点
  - 任务管理：实现对任务的下发，删除，杀死，暂停等操作
  - 日志管理：主要是通过对MongoDB数据库的读取获取运行日志。
- 服务后台:向前端和其他应用提供API
- 认证中间件：区分是内部进程调用还是外部用户调用,然后利用中间件在到达API前进行认证
- 日志存储：对API请求进行


## 完成进度
|      功能      | 完成进度 | 预计完成  |                                 注                                   |
| :------------: | :------: | :-------: | :-----------------------------------------------------------: |
|   任务的管理   |  已完成  |     *     |                     也就是对etcd数据库的操作                     |
|    获取日志    |  已完成  |     *     |                         对mongodb的读取                          |
|  docker的部署  |   70%    | 2020/3/2  | 未完成Mongodb部署，已完成etcd，Crontab-Masterd的部署和镜像的生成 |
|    节点发现    |  已完成  |     *     |                         对mongodb的读取                          |
|    服务后2020/3/7   |  已完成  |     *     |                    2020/3/7       提供API                              |2020/3/7
|   认证中间2020/3/7   |    0%    | 2020/3/28 |                        防止API的恶意访问                         |
| 传送信息的加密 |    0%    | 2020/3/15 |                          考虑使用https                           |
| 日志存储 | 0% | 2020/3/7 | 存进一个日志文件，方便后面对其进行审计或者日志分析 |



# worker节点
## 功能
- 配置信息的读取,配置文件为json文件

- 节点注册：往etcd数据库注册节点，让其可悲master发现
- 任务调度：更加不同任务的特性，对任务进行调度。如有点任务的单点指定的，指定某个节点去运行。有点是抢锁方式的。同时支持对任务的强杀。
- 日志管理：对完成后进行日志写入，现阶段是存入mongodbdb数据库
- 安全访问数据库：对连接时做一些认证，如简单秘钥连接
- 数据库集群搭建：对etcd，mongodb的数据库集群搭建
- 搭建一个日志平台ELK+KAFKA(可选，有时间就做)
## 完成进入
| 功能  | 完成进度 | 预计完成 | 注 |
| :---: | :------: | :------: | :------: |
| 节点注册 | 90% | 2020/3/7 | 还需增加一些字段 |
| 任务调度 | 50% | 2020/3/15 | 抢锁方式已经完成，现在准备全局模式和单点模式  |
|  日志管理 | 已完成  | * |  日志存储的函数已经完成，直接调用就可以了 |
| 安全访问数据库 | 0% | 2020/4/1  | 现在都是没有认证对一些数据库直接读取，后面设置成需要密码连接  |
| 数据库集群搭建 | 0% | 2020/4/1 | 数据库集群化，增加可用性 |
| 搭建一个日志平台ELK+KAFKA |  0% |  * |  可选  |


# 使用方法
