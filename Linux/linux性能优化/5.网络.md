# 概述
- 网卡传输限制
  - 物理链路中并不能传输任意大小的数据包，网络接口配置的**最大传输单元（MTU）**，以太网中，MTU默认是1500。
  - 一旦网络包超过 MTU 的大小，就会在**网络层分片**
- 到了网络层，决定是交给上层的传输层还是转发

<div align="center" style="zoom:60%"><img src="pic/5-1.png"></div>

## 接收与发送细节

<div align="center" style="zoom:60%"><img src="pic/5-2.png"></div>

- 内核分配一个主内存地址段（**DMA缓冲区**)，网卡设备可以在DMA缓冲区中读写数据

- 接收：
  - 网卡收到网络帧后，把数据先放在 DMA缓冲区（收包队列）
  - 网卡通过硬件中断通知 中断处理程序
  - 中断处理程序会为网络帧分配**内核数据结构（sk_buff）**，并将数据帧**从DMA缓冲区（收包队列）拷贝到 sk_buff 缓冲区**中
  - 通过软中断，**通知内核**收到了新的网络帧
    - 注意是 通知内核
  - 内核协议栈（库）从缓冲区取出网络帧，通过网络协议栈，从下到上进行处理。
    - 在网络层决定转发还是向上提交
    - 再传输层中，根据 **< 源 IP、源端口、目的 IP、目的端口 > 四元组作为标识，找出对应的 Socket**，并**把数据拷贝到 Socket 的接收缓冲区中**
  - 注：DMA缓冲==>sk_buff==>socket接收缓冲区

- 发送：
  - 用户把发送的数据放在 socket缓冲区中
  - 调用系统调用（socket api），进入内核态。通过内核协议栈的层层封装，将数据放到 DMA缓冲区（发包队列）
  - socket发送缓冲区==>DMA缓冲
- 对上面的发送和接收细节，持有怀疑态度

