# 概述
- 学习方法：只要理解了应用程序和系统的**少数几个基本原理**，再进行大量的实战练习，**建立起整体性能的全局观**，大多数性能问题的优化就会水到渠成。
  - **不需要了解每个组件的所有实现细节**，只要能理解它们最基本的工作原理和协作方式


- 性能指标两个视角：
  - 应用负载视角：吞吐、延时等
  - 系统资源视角：资源使用率，饱和度等

<div align="center" style="zoom:40%"><img src="pic/1-1.webp"></div>

- 性能问题的本质：当**系统资源已经到瓶颈**了，而请求处理不够快或者吞吐不够大时，**找出应用或系统的瓶颈，并设法去避免或者缓解**。
- 步骤
  1. 选择指标
  2. 设置目标
  3. 基准测试
  4. 分析瓶颈
  5. 优化应用
  6. 性能监控和告警

- Linux性能工具图谱（Brendan Gregg）
  - **千万不要把性能工具当成学习的全部，只是工具**
<div align="center" style="zoom:40%"><img src="pic/1-2.webp"></div>

- 性能分析内容
<div align="center" style="zoom:40%"><img src="pic/1-3.png"></div>

# 工具
| 工具 | 作用  | 备注 | 
| --- | --- | --- |
| top | cpu使用率，平均负载，各个进程所占cpu使用率、内存使用情况的快照 | CPU，MEM |
| uptime | 查看平均负载，当前系统启动时间和用户数 | CPU;搭配 watch -d  |
| mpstat | 实时查看每个 CPU 的性能指标，以及所有 CPU 的平均指标 | CPU |
| pidstat | 实时查看进程的 CPU、内存、I/O 以及上下文切换等性能指标 | 进程，内存，IO（-d）,线程(-t) |
| vmstat | 主要用来分析系统的内存使用情况，也常用来分析 CPU 上下文切换和中断的次数 | CPU,MEM |
| perf | 能够实时显示占用 CPU 时钟最多的函数或者指令，因此可以用来查找热点函数 | CPU |
| ab  |  web压力测试工具 | WEB |
| pstree | 进程树，找进程关系  | 进程  |
|  execsnoop | 一个专门为短时进程设计的工具 | 短进程  |
| dstat | 一个新的性能工具，它吸收了 vmstat、iostat、ifstat 等几种工具的优点，可以同时观察系统的 CPU、磁盘 I/O、网络以及内存使用情况 | |
| strace  | 跟踪进程的系统调用 | 系统调用；多线程时可能查不到 |  
| tcpdump | 抓包工具  | |
| sar | 一个系统活动报告工具，既可以实时查看系统的当前活动，又可以配置保存和报告历史统计数据 | 可以显示网络报告，`-n DEV`，网络吞吐和pps；-r 内存情况； -S swap 情况 |
| free | 查看内存使用情况 |  MEM |
| cachestat | 系统缓存的使用情况，以及命中率 | Cache |
| cachetop | 各个进程的缓存使用情况 | Cache |
| pcstat file_path | 文件的缓存使用情况 | Cache |
| df | 磁盘容量 | IO |
| slabtop | 磁盘缓存 | IO |
| iostat | 每个磁盘的情况 | IO |
| iotop | 按照 I/O 大小对进程排序 | IO |
| filetop | 观察文件的读写情况  | IO,BCC |
| opensnoop | 可以动态跟踪内核中的 open 系统调用,找到调用时打开哪个目录 | IO，BCC |
| ss | 协议栈信息，套接字信息 | Net  |
| netsta | 协议栈信息，套接字信息 | Net |
| ifconfig，ip | 网络接口信息 |  net |
| ping | 连通性，延迟 | net |

